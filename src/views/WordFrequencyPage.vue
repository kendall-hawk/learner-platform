<!--
/**
 * üìÇ src/views/WordFrequencyPage.vue
 * üéØ WordFrequencyPage.vue - ËØçÈ¢ëÂàÜÊûêÁ≥ªÁªü‰∏ªÈ°µÈù¢ÁªÑ‰ª∂
 * 
 * üìã ÂäüËÉΩÊ¶ÇËø∞:
 * - Êèê‰æõÂÆåÊï¥ÁöÑËØçÈ¢ëÂàÜÊûêÁî®Êà∑ÁïåÈù¢
 * - ÈõÜÊàêÊêúÁ¥¢„ÄÅÂèØËßÜÂåñ„ÄÅÁªüËÆ°ÂíåÂØºÂá∫ÂäüËÉΩ
 * - ÊîØÊåÅÊô∫ËÉΩÊêúÁ¥¢ÂíåÁ≤æÁ°ÆÂåπÈÖç‰∏§ÁßçÊ®°Âºè
 * - ÂÆûÁé∞ËÆ¢ÈòÖÂäüËÉΩÈó®ÊéßÂíåÂçáÁ∫ßÂºïÂØº
 * - Êèê‰æõÂìçÂ∫îÂºèËÆæËÆ°ÈÄÇÈÖçÂ§öÁ´ØËÆæÂ§á
 * 
 * üéØ ‰∏ªË¶ÅÂäüËÉΩ:
 * - ËØçÈ¢ëÊêúÁ¥¢ÂíåËøáÊª§Á≥ªÁªü
 * - Â§öÁßçÊï∞ÊçÆÂèØËßÜÂåñÂ±ïÁ§∫ÔºàËØç‰∫ë„ÄÅÂõæË°®„ÄÅÂàóË°®Ôºâ
 * - ËØ¶ÁªÜÁöÑËØçÊ±áÂàÜÊûêÂíå‰∏ä‰∏ãÊñáÂ±ïÁ§∫
 * - Ë∑®ÊñáÁ´†ÊêúÁ¥¢ÂíåÂØºËà™ÂäüËÉΩ
 * - Êï∞ÊçÆÂØºÂá∫ÂíåÂàÜ‰∫´ÂäüËÉΩ
 * - Â≠¶‰π†ËøõÂ∫¶ÁªüËÆ°ÂíåÂàÜÊûê
 * 
 * üèóÔ∏è Êû∂ÊûÑËÆæËÆ°:
 * - Ê®°ÂùóÂåñÁªÑ‰ª∂ËÆæËÆ°ÔºåËÅåË¥£ÂàÜÁ¶ªÊ∏ÖÊô∞
 * - ÂìçÂ∫îÂºèÁä∂ÊÄÅÁÆ°ÁêÜÈõÜÊàê
 * - ÂºÇÊ≠•Êï∞ÊçÆÂä†ËΩΩÂíåÁºìÂ≠òÁ≠ñÁï•
 * - ËÆ¢ÈòÖÂäüËÉΩÈó®ÊéßÈõÜÊàê
 * - ÊÄßËÉΩ‰ºòÂåñÁöÑÂ§ßÊï∞ÊçÆÂ§ÑÁêÜ
 * 
 * üîó ÈõÜÊàêÁªÑ‰ª∂:
 * - SearchPanel: Êô∫ËÉΩÊêúÁ¥¢Èù¢Êùø
 * - FrequencyChart: È¢ëÁéáÂõæË°®ÁªÑ‰ª∂
 * - WordCloud: ‰∫§‰∫íÂºèËØç‰∫ë
 * - WordDetails: ËØ¶ÁªÜËØçÊ±áÂàÜÊûê
 * - FeatureGate: ÂäüËÉΩÈó®ÊéßÁªÑ‰ª∂
 * 
 * üì° PropsÊé•Âè£:
 * - Êó†PropsÔºåÈÄöËøáË∑ØÁî±Êü•ËØ¢ÂèÇÊï∞Êé•Êî∂ÂàùÂßãÊêúÁ¥¢Êù°‰ª∂
 * 
 * üé® Ê†∑ÂºèÁâπËâ≤:
 * - Áé∞‰ª£ÂåñÂç°ÁâáÂ∏ÉÂ±ÄËÆæËÆ°
 * - ÂìçÂ∫îÂºèÁΩëÊ†ºÁ≥ªÁªü
 * - Âπ≥ÊªëÁöÑÂä®ÁîªËøáÊ∏°ÊïàÊûú
 * - ÁßªÂä®Á´Ø‰ºòÂåñÁöÑËß¶Êë∏‰∫§‰∫í
 * 
 * üõ°Ô∏è ÂÆâÂÖ®ËÄÉËôë:
 * - ËæìÂÖ•È™åËØÅÂíåÊ∏ÖÁêÜ
 * - XSSÈò≤Êä§ÁöÑÂÜÖÂÆπÊ∏≤Êüì
 * - ËÆ¢ÈòÖÁä∂ÊÄÅÈ™åËØÅ
 * - ‰ΩøÁî®ÈáèÈôêÂà∂Ê£ÄÊü•
 * 
 * ‚öôÔ∏è ÈÖçÁΩÆÈÄâÈ°π:
 * - ÊêúÁ¥¢Ê®°ÂºèÂàáÊç¢ÔºàÊô∫ËÉΩ/Á≤æÁ°ÆÔºâ
 * - ÂèØËßÜÂåñÁ±ªÂûãÈÄâÊã©
 * - ÊòæÁ§∫Êï∞ÈáèÈôêÂà∂Ë∞ÉÊï¥
 * - ÂØºÂá∫Ê†ºÂºèÈÄâÊã©
 */
-->

<template>
  <MainLayout>
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <!-- üéØ È°µÈù¢Ê†áÈ¢òÂíåÁä∂ÊÄÅÂ±ïÁ§∫Âå∫Âüü -->
      <div class="mb-8">
        <div class="flex items-center justify-between">
          <div>
            <h1 class="text-3xl font-bold text-gray-900">Word Frequency Analysis</h1>
            <p class="text-gray-600 mt-2">
              Analyze word patterns and frequency across your reading materials
            </p>
          </div>
          
          <!-- üíé ‰∏ì‰∏öÁâàÂäüËÉΩÊ†áËØÜ -->
          <div v-if="subscriptionStore.isPro" class="flex items-center space-x-2">
            <div class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium">
              ‚ú® Pro Features Enabled
            </div>
          </div>
        </div>
      </div>

      <!-- üîç Êô∫ËÉΩÊêúÁ¥¢Èù¢ÊùøÁªÑ‰ª∂ -->
      <div class="mb-8">
        <SearchPanel
          v-model:query="searchQuery"
          v-model:mode="searchMode"
          v-model:filters="filters"
          :loading="isSearching"
          @search="handleSearch"
          @clear="handleClear"
        />
      </div>

      <!-- üìä ÂàÜÊûêÁªìÊûúÂ±ïÁ§∫Âå∫Âüü -->
      <div v-if="hasResults || isLoading" class="space-y-8">
        <!-- ‚è≥ Âä†ËΩΩÁä∂ÊÄÅÊåáÁ§∫Âô® -->
        <div v-if="isLoading" class="flex items-center justify-center py-12">
          <LoadingSpinner size="large" text="Analyzing word frequencies..." />
        </div>

        <!-- üìà Êï∞ÊçÆÂèØËßÜÂåñÂíåÁªüËÆ°Âå∫Âüü -->
        <div v-else-if="hasResults" class="grid grid-cols-1 lg:grid-cols-3 gap-8">
          <!-- üìä ‰∏ªË¶ÅÂÜÖÂÆπÂå∫Âüü -->
          <div class="lg:col-span-2 space-y-6">
            <!-- üìã ÁªüËÆ°ÊëòË¶ÅÂç°Áâá -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
              <div class="card card-body text-center">
                <div class="text-2xl font-bold text-blue-600">{{ stats.totalWords.toLocaleString() }}</div>
                <div class="text-sm text-gray-600">Total Words</div>
              </div>
              <div class="card card-body text-center">
                <div class="text-2xl font-bold text-green-600">{{ stats.uniqueWords.toLocaleString() }}</div>
                <div class="text-sm text-gray-600">Unique Words</div>
              </div>
              <div class="card card-body text-center">
                <div class="text-2xl font-bold text-purple-600">{{ stats.articlesAnalyzed }}</div>
                <div class="text-sm text-gray-600">Articles</div>
              </div>
              <div class="card card-body text-center">
                <div class="text-2xl font-bold text-orange-600">{{ stats.averageLength.toFixed(1) }}</div>
                <div class="text-sm text-gray-600">Avg Length</div>
              </div>
            </div>

            <!-- ‚òÅÔ∏è ‰∫§‰∫íÂºèËØç‰∫ëÁªÑ‰ª∂ -->
            <div class="card">
              <div class="card-body">
                <div class="flex items-center justify-between mb-4">
                  <h3 class="text-lg font-semibold text-gray-900">Word Cloud</h3>
                  <div class="flex items-center space-x-2">
                    <button
                      @click="refreshWordCloud"
                      class="text-gray-400 hover:text-gray-600 transition-colors"
                      title="Refresh"
                    >
                      <ArrowPathIcon class="w-5 h-5" />
                    </button>
                  </div>
                </div>
                
                <!-- üö™ ÂäüËÉΩÈó®ÊéßÂåÖË£ÖÁöÑËØç‰∫ëÁªÑ‰ª∂ -->
                <FeatureGate 
                  feature="cross_article_search"
                  :show-preview="true"
                >
                  <WordCloud
                    :words="topWords"
                    :height="300"
                    @word-click="handleWordClick"
                  />
                  
                  <!-- üí∞ ÂçáÁ∫ßÊèêÁ§∫ÂêéÂ§áÂÜÖÂÆπ -->
                  <template #fallback>
                    <div class="text-center py-8">
                      <CloudIcon class="w-16 h-16 text-gray-300 mx-auto mb-4" />
                      <h4 class="text-lg font-medium text-gray-900 mb-2">Advanced Word Cloud</h4>
                      <p class="text-gray-600 mb-4">
                        Visualize word relationships with our interactive word cloud
                      </p>
                      <button
                        @click="$router.push('/subscription')"
                        class="btn-primary"
                      >
                        Upgrade to Pro
                      </button>
                    </div>
                  </template>
                </FeatureGate>
              </div>
            </div>

            <!-- üìà È¢ëÁéáÂàÜÂ∏ÉÂõæË°®ÁªÑ‰ª∂ -->
            <div class="card">
              <div class="card-body">
                <div class="flex items-center justify-between mb-4">
                  <h3 class="text-lg font-semibold text-gray-900">Frequency Distribution</h3>
                  <div class="flex items-center space-x-2">
                    <select
                      v-model="chartType"
                      class="text-sm border-gray-300 rounded-md"
                    >
                      <option value="bar">Bar Chart</option>
                      <option value="line">Line Chart</option>
                      <option value="area">Area Chart</option>
                    </select>
                  </div>
                </div>
                
                <FrequencyChart
                  :data="chartData"
                  :type="chartType"
                  :height="400"
                  @bar-click="handleChartClick"
                />
              </div>
            </div>
          </div>

          <!-- üìã ‰æßËæπÊ†è‰ø°ÊÅØÈù¢Êùø -->
          <div class="space-y-6">
            <!-- üèÜ È´òÈ¢ëËØçÂàóË°® -->
            <div class="card">
              <div class="card-body">
                <div class="flex items-center justify-between mb-4">
                  <h3 class="text-lg font-semibold text-gray-900">Top Words</h3>
                  <div class="text-sm text-gray-500">
                    Showing {{ Math.min(displayLimit, topWords.length) }} of {{ topWords.length }}
                  </div>
                </div>
                
                <!-- üîÑ ÊªöÂä®ÂàóË°®ÂÆπÂô® -->
                <div class="space-y-2 max-h-96 overflow-y-auto">
                  <div
                    v-for="(word, index) in topWords.slice(0, displayLimit)"
                    :key="word.word"
                    class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer"
                    @click="handleWordClick(word.word)"
                  >
                    <div class="flex items-center space-x-3">
                      <div class="text-xs font-medium text-gray-500 w-6">
                        #{{ index + 1 }}
                      </div>
                      <div>
                        <div class="font-medium text-gray-900">{{ word.word }}</div>
                        <div class="text-xs text-gray-500">
                          {{ word.frequency }} occurrences
                        </div>
                      </div>
                    </div>
                    <div class="flex items-center space-x-2">
                      <div class="w-16 bg-gray-200 rounded-full h-2">
                        <div
                          class="bg-blue-600 h-2 rounded-full"
                          :style="{ width: `${(word.frequency / topWords[0].frequency) * 100}%` }"
                        ></div>
                      </div>
                      <ArrowRightIcon class="w-4 h-4 text-gray-400" />
                    </div>
                  </div>
                </div>
                
                <!-- üìÑ ÂàÜÈ°µÂä†ËΩΩÊõ¥Â§ö -->
                <div v-if="topWords.length > displayLimit" class="mt-4 text-center">
                  <button
                    @click="displayLimit += 20"
                    class="text-primary-600 hover:text-primary-700 text-sm font-medium"
                  >
                    Show More
                  </button>
                </div>
              </div>
            </div>

            <!-- üîç ËØçÊ±áËØ¶ÊÉÖÂàÜÊûêÈù¢Êùø -->
            <div v-if="selectedWord" class="card">
              <div class="card-body">
                <div class="flex items-center justify-between mb-4">
                  <h3 class="text-lg font-semibold text-gray-900">Word Details</h3>
                  <button
                    @click="selectedWord = null"
                    class="text-gray-400 hover:text-gray-600"
                  >
                    <XMarkIcon class="w-5 h-5" />
                  </button>
                </div>
                
                <WordDetails
                  :word="selectedWord"
                  :analysis="selectedWordAnalysis"
                  @navigate-to-article="handleNavigateToArticle"
                />
              </div>
            </div>

            <!-- üì§ Êï∞ÊçÆÂØºÂá∫ÂäüËÉΩÂå∫Âüü -->
            <FeatureGate feature="export_features">
              <div class="card">
                <div class="card-body">
                  <h3 class="text-lg font-semibold text-gray-900 mb-4">Export Results</h3>
                  <div class="space-y-2">
                    <button
                      @click="exportResults('csv')"
                      class="w-full btn-outline text-sm"
                      :disabled="!hasResults"
                    >
                      <DocumentArrowDownIcon class="w-4 h-4 mr-2" />
                      Export as CSV
                    </button>
                    <button
                      @click="exportResults('json')"
                      class="w-full btn-outline text-sm"
                      :disabled="!hasResults"
                    >
                      <DocumentArrowDownIcon class="w-4 h-4 mr-2" />
                      Export as JSON
                    </button>
                    <button
                      @click="exportResults('pdf')"
                      class="w-full btn-outline text-sm"
                      :disabled="!hasResults"
                    >
                      <DocumentArrowDownIcon class="w-4 h-4 mr-2" />
                      Export as PDF
                    </button>
                  </div>
                </div>
              </div>
              
              <!-- üí∞ ÂØºÂá∫ÂäüËÉΩÂçáÁ∫ßÊèêÁ§∫ -->
              <template #fallback>
                <div class="card">
                  <div class="card-body text-center">
                    <DocumentArrowDownIcon class="w-12 h-12 text-gray-300 mx-auto mb-3" />
                    <h4 class="font-medium text-gray-900 mb-2">Export Features</h4>
                    <p class="text-sm text-gray-600 mb-3">
                      Export your analysis in multiple formats
                    </p>
                    <button
                      @click="$router.push('/subscription')"
                      class="btn-primary text-sm"
                    >
                      Upgrade to Export
                    </button>
                  </div>
                </div>
              </template>
            </FeatureGate>
          </div>
        </div>
      </div>

      <!-- üöÄ È¶ñÊ¨°ËÆøÈóÆÂºïÂØºÁïåÈù¢ -->
      <div v-else-if="!hasSearched" class="text-center py-16">
        <ChartBarIcon class="w-24 h-24 text-gray-300 mx-auto mb-6" />
        <h3 class="text-xl font-medium text-gray-900 mb-2">
          Start Your Word Analysis
        </h3>
        <p class="text-gray-600 mb-6 max-w-md mx-auto">
          Search for words to see their frequency patterns, usage contexts, and distribution across articles.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <button
            @click="runSampleAnalysis"
            class="btn-primary"
          >
            Try Sample Analysis
          </button>
          <button
            @click="$router.push('/articles')"
            class="btn-outline"
          >
            Browse Articles
          </button>
        </div>
      </div>

      <!-- üîç Êó†ÊêúÁ¥¢ÁªìÊûúÁä∂ÊÄÅ -->
      <div v-else class="text-center py-16">
        <MagnifyingGlassIcon class="w-24 h-24 text-gray-300 mx-auto mb-6" />
        <h3 class="text-xl font-medium text-gray-900 mb-2">
          No Results Found
        </h3>
        <p class="text-gray-600 mb-6">
          Try adjusting your search terms or search mode.
        </p>
        <button
          @click="handleClear"
          class="btn-outline"
        >
          Clear Search
        </button>
      </div>
    </div>
  </MainLayout>
</template>

<script setup lang="ts">
import { ref, computed, onMounted, watch } from 'vue'
import { useRouter, useRoute } from 'vue-router'
import { useWordFrequencyStore } from '@/stores/wordFrequency'
import { useAuthStore } from '@/stores/auth'
import { useSubscriptionStore } from '@/stores/subscription'
import MainLayout from '@/layouts/MainLayout.vue'
import SearchPanel from '@/components/wordFreq/SearchPanel.vue'
import FrequencyChart from '@/components/wordFreq/FrequencyChart.vue'
import WordCloud from '@/components/wordFreq/WordCloud.vue'
import WordDetails from '@/components/wordFreq/WordDetails.vue'
import FeatureGate from '@/components/subscription/FeatureGate.vue'
import LoadingSpinner from '@/components/common/LoadingSpinner.vue'

// Icons
import {
  ChartBarIcon,
  MagnifyingGlassIcon,
  ArrowPathIcon,
  ArrowRightIcon,
  XMarkIcon,
  DocumentArrowDownIcon,
  CloudIcon
} from '@heroicons/vue/24/outline'

const router = useRouter()
const route = useRoute()
const wordFreqStore = useWordFrequencyStore()
const authStore = useAuthStore()
const subscriptionStore = useSubscriptionStore()

// üîÑ ÂìçÂ∫îÂºèÊêúÁ¥¢Áä∂ÊÄÅÁÆ°ÁêÜ
const searchQuery = ref('')
const searchMode = ref<'intelligent' | 'exact'>('intelligent')
const filters = ref({
  minLength: 3,
  excludeCommon: true,
  partOfSpeech: [],
  articles: []
})

// üé® ÁïåÈù¢ÊòæÁ§∫Áä∂ÊÄÅÊéßÂà∂
const chartType = ref<'bar' | 'line' | 'area'>('bar')
const displayLimit = ref(20)
const selectedWord = ref<string | null>(null)

// üìä ËÆ°ÁÆóÂ±ûÊÄß - Êï∞ÊçÆÁä∂ÊÄÅÊ£ÄÊü•
const isLoading = computed(() => wordFreqStore.isLoading)
const isSearching = computed(() => wordFreqStore.isSearching)
const hasResults = computed(() => wordFreqStore.results.length > 0)
const hasSearched = computed(() => wordFreqStore.hasSearched)
const topWords = computed(() => wordFreqStore.results.slice(0, 100))
const stats = computed(() => wordFreqStore.stats)

// üìà ÂõæË°®Êï∞ÊçÆËΩ¨Êç¢
const chartData = computed(() => {
  return topWords.value.slice(0, 20).map(word => ({
    word: word.word,
    frequency: word.frequency,
    articles: word.articles.length
  }))
})

// üîç ÈÄâ‰∏≠ËØçÊ±áÂàÜÊûêÊï∞ÊçÆ
const selectedWordAnalysis = computed(() => {
  if (!selectedWord.value) return null
  return wordFreqStore.getWordAnalysis(selectedWord.value)
})

/**
 * üîç ÊâßË°åËØçÊ±áÊêúÁ¥¢ÂàÜÊûê
 * 
 * üìã ÊêúÁ¥¢ÊµÅÁ®ã:
 * - È™åËØÅÊêúÁ¥¢Êü•ËØ¢ÊúâÊïàÊÄß
 * - Ë∞ÉÁî®ËØçÈ¢ëÂàÜÊûêÊúçÂä°
 * - Êõ¥Êñ∞ÊêúÁ¥¢Áä∂ÊÄÅÂíåÁªìÊûú
 * - Â§ÑÁêÜÊêúÁ¥¢ÈîôËØØÊÉÖÂÜµ
 * 
 * üõ°Ô∏è ÂÆâÂÖ®Ê£ÄÊü•:
 * - Á©∫Êü•ËØ¢È™åËØÅ
 * - ÊêúÁ¥¢È¢ëÁéáÈôêÂà∂
 * - ÈîôËØØÁä∂ÊÄÅÂ§ÑÁêÜ
 */
const handleSearch = async () => {
  if (!searchQuery.value.trim()) return
  
  await wordFreqStore.searchWords({
    query: searchQuery.value,
    mode: searchMode.value,
    filters: filters.value
  })
}

/**
 * üßπ Ê∏ÖÁ©∫ÊêúÁ¥¢ÁªìÊûúÂíåÁä∂ÊÄÅ
 * 
 * üìã Ê∏ÖÁêÜËåÉÂõ¥:
 * - ÊêúÁ¥¢Êü•ËØ¢ÂÜÖÂÆπ
 * - ÂàÜÊûêÁªìÊûúÊï∞ÊçÆ
 * - ÈÄâ‰∏≠ËØçÊ±áÁä∂ÊÄÅ
 * - ÈîôËØØ‰ø°ÊÅØÊ∏ÖÈô§
 */
const handleClear = () => {
  searchQuery.value = ''
  wordFreqStore.clearResults()
  selectedWord.value = null
}

/**
 * üéØ Â§ÑÁêÜËØçÊ±áÁÇπÂáªÈÄâÊã©‰∫ã‰ª∂
 * 
 * @param word - ÈÄâ‰∏≠ÁöÑËØçÊ±á
 * 
 * üìã ‰∫§‰∫íÈÄªËæë:
 * - Êõ¥Êñ∞ÈÄâ‰∏≠ËØçÊ±áÁä∂ÊÄÅ
 * - ÊªöÂä®Âà∞ËØ¶ÊÉÖÈù¢Êùø
 * - Âä†ËΩΩËØçÊ±áÂàÜÊûêÊï∞ÊçÆ
 */
const handleWordClick = (word: string) => {
  selectedWord.value = word
  // Scroll to word details
  const detailsElement = document.querySelector('.word-details')
  if (detailsElement) {
    detailsElement.scrollIntoView({ behavior: 'smooth' })
  }
}

/**
 * üìä Â§ÑÁêÜÂõæË°®ÁÇπÂáª‰∫§‰∫í
 * 
 * @param data - ÂõæË°®Êï∞ÊçÆÁÇπ
 * 
 * üìã ÂäüËÉΩËØ¥Êòé:
 * - ÂõæË°®Êï∞ÊçÆÁÇπÈÄâÊã©
 * - ËØçÊ±áËØ¶ÊÉÖÈù¢ÊùøËÅîÂä®
 * - Áî®Êà∑‰∫§‰∫íÂèçÈ¶à
 */
const handleChartClick = (data: any) => {
  handleWordClick(data.word)
}

/**
 * üîó Ë∑®ÊñáÁ´†ÂØºËà™ÂäüËÉΩ
 * 
 * @param articleId - ÁõÆÊ†áÊñáÁ´†ID
 * @param word - È´ò‰∫ÆËØçÊ±á
 * 
 * üìã ÂØºËà™ÈÄªËæë:
 * - ÊûÑÂª∫ÊñáÁ´†Ë∑ØÁî±ÂèÇÊï∞
 * - ‰º†ÈÄíÈ´ò‰∫ÆËØçÊ±áÊü•ËØ¢
 * - ÂÆûÁé∞Ë∑®È°µÈù¢Êï∞ÊçÆ‰º†ÈÄí
 */
const handleNavigateToArticle = (articleId: string, word: string) => {
  router.push({
    name: 'Article',
    params: { id: articleId },
    query: { highlight: word }
  })
}

/**
 * üîÑ Âà∑Êñ∞ËØç‰∫ëÂèØËßÜÂåñ
 * 
 * üìã Âà∑Êñ∞Êìç‰Ωú:
 * - Ëß¶ÂèëËØç‰∫ëÈáçÊñ∞Ê∏≤Êüì
 * - Êõ¥Êñ∞Â∏ÉÂ±ÄÁÆóÊ≥ï
 * - ‰øùÊåÅÁî®Êà∑‰ΩìÈ™åÊµÅÁïÖ
 */
const refreshWordCloud = () => {
  wordFreqStore.refreshVisualization()
}

/**
 * üöÄ ËøêË°åÁ§∫‰æãÂàÜÊûêÊºîÁ§∫
 * 
 * üìã ÊºîÁ§∫ÂäüËÉΩ:
 * - È¢ÑËÆæÊêúÁ¥¢Êü•ËØ¢
 * - Ëá™Âä®ÊâßË°åÂàÜÊûê
 * - ÂºïÂØºÁî®Êà∑‰ΩìÈ™åÂäüËÉΩ
 */
const runSampleAnalysis = async () => {
  searchQuery.value = 'learning'
  searchMode.value = 'intelligent'
  await handleSearch()
}

/**
 * üì§ Êï∞ÊçÆÂØºÂá∫ÂäüËÉΩÂ§ÑÁêÜ
 * 
 * @param format - ÂØºÂá∫Ê†ºÂºè ('csv' | 'json' | 'pdf')
 * 
 * üìã ÂØºÂá∫ÊµÅÁ®ã:
 * - È™åËØÅÁªìÊûúÊï∞ÊçÆÂ≠òÂú®
 * - Ë∞ÉÁî®Áõ∏Â∫îÊ†ºÂºèÂØºÂá∫
 * - Â§ÑÁêÜÂØºÂá∫ÈîôËØØÊÉÖÂÜµ
 * - Êèê‰æõÁî®Êà∑ÂèçÈ¶à
 * 
 * üõ°Ô∏è ÈîôËØØÂ§ÑÁêÜ:
 * - Á©∫Êï∞ÊçÆÊ£ÄÊü•
 * - Ê†ºÂºèÊîØÊåÅÈ™åËØÅ
 * - ÂØºÂá∫Â§±Ë¥•ÊèêÁ§∫
 */
const exportResults = async (format: 'csv' | 'json' | 'pdf') => {
  if (!hasResults.value) return
  
  try {
    await wordFreqStore.exportResults(format)
  } catch (error) {
    console.error('Export failed:', error)
  }
}

/**
 * üîó Ë∑ØÁî±Êü•ËØ¢ÂèÇÊï∞ÁõëÂê¨Âô®
 * 
 * üìã ÁõëÂê¨ÂäüËÉΩ:
 * - URLÊü•ËØ¢ÂèÇÊï∞ÂèòÂåñ
 * - Ëá™Âä®ÊâßË°åÊêúÁ¥¢
 * - ÊîØÊåÅ‰π¶Á≠æÂíåÂàÜ‰∫´ÈìæÊé•
 * - ÊµèËßàÂô®ÂâçËøõÂêéÈÄÄÊîØÊåÅ
 */
watch(() => route.query, (newQuery) => {
  if (newQuery.word) {
    searchQuery.value = newQuery.word as string
    searchMode.value = (newQuery.mode as any) || 'intelligent'
    handleSearch()
  }
}, { immediate: true })

/**
 * üéØ ÁªÑ‰ª∂ÂàùÂßãÂåñÁîüÂëΩÂë®Êúü
 * 
 * üìã ÂàùÂßãÂåñ‰ªªÂä°:
 * - Ê£ÄÊü•ËØçÈ¢ëÂ≠òÂÇ®ÂàùÂßãÂåñÁä∂ÊÄÅ
 * - Âä†ËΩΩÂøÖË¶ÅÁöÑÂü∫Á°ÄÊï∞ÊçÆ
 * - Â§ÑÁêÜÂàùÂßãÂåñÈîôËØØÊÉÖÂÜµ
 */
onMounted(async () => {
  if (!wordFreqStore.isInitialized) {
    await wordFreqStore.initialize()
  }
})
</script>