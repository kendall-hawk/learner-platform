<!--
/**3. src/views/Dashboard.vue
 * üìä Dashboard.vue - Áî®Êà∑‰ª™Ë°®Êùø
 * 
 * üìã ÂäüËÉΩÊ¶ÇËø∞:
 * - Áî®Êà∑ÁôªÂΩïÂêéÁöÑ‰∏ªÈ°µÈù¢ÔºåÂ±ïÁ§∫Â≠¶‰π†ËøõÂ∫¶ÂíåÁªüËÆ°Êï∞ÊçÆ
 * - Êèê‰æõÂø´ÈÄüËÆøÈóÆÂ∏∏Áî®ÂäüËÉΩÁöÑÂÖ•Âè£
 * - ÊòæÁ§∫ËÆ¢ÈòÖÁä∂ÊÄÅÂíåÂçáÁ∫ßÊèêÁ§∫
 * - ‰∏™ÊÄßÂåñÊé®ËçêÂíåÂ≠¶‰π†ÁõÆÊ†áÁÆ°ÁêÜ
 * - ÂìçÂ∫îÂºèËÆæËÆ°ÔºåÂÆåÁæéÈÄÇÈÖçÂêÑÁßçËÆæÂ§á
 * 
 * üéØ ‰∏ªË¶ÅÂäüËÉΩ:
 * - Â≠¶‰π†ÁªüËÆ°Êï∞ÊçÆÂ±ïÁ§∫ÔºàÊñáÁ´†„ÄÅÂçïËØç„ÄÅÊó∂Èó¥„ÄÅËøûÁª≠Â§©Êï∞Ôºâ
 * - ÊúÄËøëÈòÖËØªÊñáÁ´†ÂàóË°®
 * - Âø´ÈÄüÊìç‰ΩúÂÖ•Âè£ÔºàËØçÈ¢ëÂàÜÊûê„ÄÅÊñáÁ´†ÊµèËßàÁ≠âÔºâ
 * - ÊØèÂë®Â≠¶‰π†ÁõÆÊ†áËøõÂ∫¶Ë∑üË∏™
 * - Â≠¶‰π†ËøûÁª≠Â§©Êï∞Êó•ÂéÜÂ±ïÁ§∫
 * - ËÆ¢ÈòÖÁä∂ÊÄÅÁÆ°ÁêÜÂíåÂçáÁ∫ßÊèêÁ§∫
 * 
 * üîó ‰æùËµñÁªÑ‰ª∂:
 * - MainLayout: ‰∏ªÂ∏ÉÂ±ÄÁªÑ‰ª∂
 * - FeatureGate: ÂäüËÉΩÈó®ÊéßÁªÑ‰ª∂
 * 
 * üì± ÂìçÂ∫îÂºèËÆæËÆ°:
 * - ÁßªÂä®Á´ØÂèãÂ•ΩÁöÑÂç°ÁâáÂ∏ÉÂ±Ä
 * - Ëá™ÈÄÇÂ∫îÁΩëÊ†ºÁ≥ªÁªü
 * - Ëß¶Êë∏ÂèãÂ•ΩÁöÑ‰∫§‰∫íÂÖÉÁ¥†
 */
-->

<template>
  <MainLayout>
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      
      <!-- üëã Ê¨¢ËøéÊ†áÈ¢òÂå∫Âüü -->
      <div class="mb-8">
        <div class="flex items-center justify-between flex-wrap gap-4">
          <!-- Ê¨¢Ëøé‰ø°ÊÅØ -->
          <div>
            <h1 class="text-3xl font-bold text-gray-900">
              Welcome back, {{ authStore.userName }}!
            </h1>
            <p class="text-gray-600 mt-1">
              Continue your English learning journey
            </p>
          </div>
          
          <!-- üé´ ËÆ¢ÈòÖÁä∂ÊÄÅÂíåÂçáÁ∫ßÊåâÈíÆ -->
          <div class="flex items-center space-x-4">
            <!-- ËÆ¢ÈòÖÁä∂ÊÄÅÂæΩÁ´† -->
            <div 
              class="px-3 py-1 rounded-full text-sm font-medium"
              :class="subscriptionBadgeClasses"
            >
              {{ subscriptionStore.getStatusBadge.text }}
            </div>
            
            <!-- ÂçáÁ∫ßÊåâÈíÆ - ‰ªÖÂÖçË¥πÁî®Êà∑ÊòæÁ§∫ -->
            <button
              v-if="subscriptionStore.isFree"
              @click="$router.push('/subscription')"
              class="btn-primary text-sm"
            >
              Upgrade to Pro
            </button>
          </div>
        </div>
      </div>

      <!-- üìä Â≠¶‰π†ÁªüËÆ°Êï∞ÊçÆÊ¶ÇËßà -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        
        <!-- üìö Â∑≤ËØªÊñáÁ´†Êï∞ÁªüËÆ° -->
        <div class="card card-body">
          <div class="flex items-center">
            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
              <BookOpenIcon class="w-5 h-5 text-blue-600" />
            </div>
            <div class="ml-4">
              <p class="text-sm font-medium text-gray-600">Articles Read</p>
              <p class="text-2xl font-bold text-gray-900">{{ progress.articlesRead }}</p>
            </div>
          </div>
          <!-- Â¢ûÈïøË∂ãÂäøÊåáÁ§∫ -->
          <div class="mt-4">
            <div class="flex items-center text-sm">
              <span class="text-green-600">+{{ progress.articlesRead }} this month</span>
            </div>
          </div>
        </div>

        <!-- üéì Â≠¶‰π†ÂçïËØçÊï∞ÁªüËÆ° -->
        <div class="card card-body">
          <div class="flex items-center">
            <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
              <AcademicCapIcon class="w-5 h-5 text-green-600" />
            </div>
            <div class="ml-4">
              <p class="text-sm font-medium text-gray-600">Words Learned</p>
              <p class="text-2xl font-bold text-gray-900">{{ progress.wordsLearned }}</p>
            </div>
          </div>
          <!-- Êú¨Âë®Â¢ûÈïøÊï∞ÊçÆ -->
          <div class="mt-4">
            <div class="flex items-center text-sm">
              <span class="text-green-600">+{{ Math.floor(progress.wordsLearned * 0.3) }} this week</span>
            </div>
          </div>
        </div>

        <!-- ‚è∞ Â≠¶‰π†Êó∂ÈïøÁªüËÆ° -->
        <div class="card card-body">
          <div class="flex items-center">
            <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
              <ClockIcon class="w-5 h-5 text-purple-600" />
            </div>
            <div class="ml-4">
              <p class="text-sm font-medium text-gray-600">Study Time</p>
              <p class="text-2xl font-bold text-gray-900">{{ studyHours }}h</p>
            </div>
          </div>
          <!-- Êú¨Âë®Êó∂ÈïøÊï∞ÊçÆ -->
          <div class="mt-4">
            <div class="flex items-center text-sm">
              <span class="text-green-600">{{ Math.floor(progress.studyTimeMinutes / 60 * 0.25) }}h this week</span>
            </div>
          </div>
        </div>

        <!-- üî• Â≠¶‰π†ËøûÁª≠Â§©Êï∞ -->
        <div class="card card-body">
          <div class="flex items-center">
            <div class="w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center">
              <FireIcon class="w-5 h-5 text-orange-600" />
            </div>
            <div class="ml-4">
              <p class="text-sm font-medium text-gray-600">Streak</p>
              <p class="text-2xl font-bold text-gray-900">{{ progress.streak }}</p>
            </div>
          </div>
          <div class="mt-4">
            <div class="flex items-center text-sm">
              <span class="text-gray-600">days in a row</span>
            </div>
          </div>
        </div>
      </div>

      <!-- üìã ‰∏ªË¶ÅÂÜÖÂÆπÁΩëÊ†ºÂ∏ÉÂ±Ä -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <!-- üìñ ÊúÄËøëÊñáÁ´† - Âç†Áî®2/3ÂÆΩÂ∫¶ -->
        <div class="lg:col-span-2">
          <div class="card">
            <div class="card-body">
              <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-semibold text-gray-900">Continue Reading</h2>
                <router-link 
                  to="/articles" 
                  class="text-primary-600 hover:text-primary-700 text-sm font-medium"
                >
                  View all
                </router-link>
              </div>

              <!-- üìö ÊñáÁ´†ÂàóË°® -->
              <div class="space-y-4">
                <div 
                  v-for="article in recentArticles" 
                  :key="article.id"
                  class="flex items-center p-4 border border-gray-200 rounded-lg hover:border-primary-300 hover:bg-primary-50 transition-all cursor-pointer group"
                  @click="$router.push(`/article/${article.id}`)"
                >
                  <div class="flex-1">
                    <!-- ÊñáÁ´†Ê†áÈ¢ò -->
                    <h3 class="font-medium text-gray-900 group-hover:text-primary-700">
                      {{ article.title }}
                    </h3>
                    <!-- ÊñáÁ´†ÂÖÉ‰ø°ÊÅØ -->
                    <p class="text-sm text-gray-600 mt-1">
                      {{ article.category }} ‚Ä¢ {{ article.estimatedReadTime }} min read
                    </p>
                    <!-- ÈöæÂ∫¶ÂíåÂ≠óÊï∞Ê†áÁ≠æ -->
                    <div class="flex items-center mt-2">
                      <div 
                        class="px-2 py-1 text-xs rounded-full"
                        :class="getDifficultyClasses(article.difficulty)"
                      >
                        {{ article.difficulty }}
                      </div>
                      <div class="ml-2 text-xs text-gray-500">
                        {{ article.wordCount }} words
                      </div>
                    </div>
                  </div>
                  <!-- ÁÆ≠Â§¥ÂõæÊ†á -->
                  <ArrowRightIcon class="w-5 h-5 text-gray-400 group-hover:text-primary-600" />
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- üéØ ‰æßËæπÊ†è - Âç†Áî®1/3ÂÆΩÂ∫¶ -->
        <div class="space-y-6">
          
          <!-- ‚ö° Âø´ÈÄüÊìç‰ΩúÈù¢Êùø -->
          <div class="card card-body">
            <h3 class="text-lg font-medium text-gray-900 mb-4">Quick Actions</h3>
            <div class="space-y-3">
              
              <!-- ËØçÈ¢ëÂàÜÊûêÂÖ•Âè£ -->
              <router-link
                to="/word-frequency"
                class="flex items-center p-3 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors group"
              >
                <ChartBarIcon class="w-5 h-5 text-purple-600 mr-3" />
                <span class="group-hover:text-gray-900">Word Analysis</span>
              </router-link>
              
              <!-- üìö ÊñáÁ´†ÊµèËßà - ‰ΩøÁî®ÂäüËÉΩÈó®Êéß -->
              <FeatureGate feature="unlimited_articles">
                <router-link
                  to="/articles"
                  class="flex items-center p-3 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors group"
                >
                  <BookOpenIcon class="w-5 h-5 text-blue-600 mr-3" />
                  <span class="group-hover:text-gray-900">Browse Articles</span>
                </router-link>
                
                <!-- üö™ ÂäüËÉΩÈó®Êéß - ÂÖçË¥πÁî®Êà∑ÊòæÁ§∫ÂçáÁ∫ßÊèêÁ§∫ -->
                <template #fallback>
                  <button
                    @click="$router.push('/subscription')"
                    class="flex items-center p-3 text-gray-500 bg-gray-50 rounded-lg cursor-not-allowed w-full"
                  >
                    <BookOpenIcon class="w-5 h-5 text-gray-400 mr-3" />
                    <span>Browse Articles</span>
                    <LockClosedIcon class="w-4 h-4 text-gray-400 ml-auto" />
                  </button>
                </template>
              </FeatureGate>

              <!-- üë§ Áî®Êà∑ËÆæÁΩÆÂÖ•Âè£ -->
              <router-link
                to="/profile"
                class="flex items-center p-3 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors group"
              >
                <UserIcon class="w-5 h-5 text-green-600 mr-3" />
                <span class="group-hover:text-gray-900">Settings</span>
              </router-link>
            </div>
          </div>

          <!-- üéØ ÊØèÂë®Â≠¶‰π†ÁõÆÊ†á -->
          <div class="card card-body">
            <h3 class="text-lg font-medium text-gray-900 mb-4">Weekly Goal</h3>
            <div class="space-y-3">
              <!-- ËøõÂ∫¶ÁôæÂàÜÊØîÊòæÁ§∫ -->
              <div class="flex justify-between text-sm">
                <span class="text-gray-600">Study Time</span>
                <span class="font-medium">{{ weeklyProgress }}%</span>
              </div>
              <!-- ËøõÂ∫¶Êù° -->
              <div class="w-full bg-gray-200 rounded-full h-2">
                <div 
                  class="bg-primary-600 h-2 rounded-full transition-all duration-300"
                  :style="{ width: `${Math.min(weeklyProgress, 100)}%` }"
                ></div>
              </div>
              <!-- ËØ¶ÁªÜËøõÂ∫¶‰ø°ÊÅØ -->
              <p class="text-xs text-gray-600">
                {{ Math.floor(weeklyStudyTime) }} / {{ progress.weeklyGoal }} minutes this week
              </p>
            </div>
          </div>

          <!-- üî• Â≠¶‰π†ËøûÁª≠Â§©Êï∞ËØ¶ÊÉÖ -->
          <div class="card card-body">
            <h3 class="text-lg font-medium text-gray-900 mb-4">Learning Streak</h3>
            <div class="text-center">
              <!-- ËøûÁª≠Â§©Êï∞Â§ßÊï∞Â≠óÊòæÁ§∫ -->
              <div class="text-3xl font-bold text-orange-600 mb-2">
                {{ progress.streak }}
              </div>
              <p class="text-sm text-gray-600 mb-4">days in a row</p>
              
              <!-- üìÖ ËøûÁª≠Â§©Êï∞Êó•ÂéÜËßÜÂõæ -->
              <div class="grid grid-cols-7 gap-1">
                <div 
                  v-for="day in streakDays" 
                  :key="day.date"
                  class="w-6 h-6 rounded text-xs flex items-center justify-center"
                  :class="day.hasStudied ? 'bg-orange-200 text-orange-800' : 'bg-gray-100 text-gray-400'"
                  :title="day.date"
                >
                  {{ day.day }}
                </div>
              </div>
            </div>
          </div>

          <!-- üíé ÂçáÁ∫ßÊèêÁ§∫ - ‰ªÖÂÖçË¥πÁî®Êà∑ÊòæÁ§∫ -->
          <div v-if="subscriptionStore.isFree" class="card card-body bg-gradient-to-r from-primary-50 to-purple-50 border-primary-200">
            <div class="text-center">
              <StarIcon class="w-8 h-8 text-yellow-500 mx-auto mb-3" />
              <h3 class="text-lg font-medium text-gray-900 mb-2">Unlock Pro Features</h3>
              <p class="text-sm text-gray-600 mb-4">
                Get unlimited articles, advanced analytics, and more!
              </p>
              <button
                @click="$router.push('/subscription')"
                class="btn-primary w-full text-sm"
              >
                Upgrade Now
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </MainLayout>
</template>

<script setup lang="ts">
/**
 * üìù ÁªÑ‰ª∂ÈÄªËæë
 * 
 * üéØ ‰∏ªË¶ÅÂäüËÉΩ:
 * - Â±ïÁ§∫Áî®Êà∑Â≠¶‰π†ËøõÂ∫¶ÂíåÁªüËÆ°Êï∞ÊçÆ
 * - ÁÆ°ÁêÜËÆ¢ÈòÖÁä∂ÊÄÅÊòæÁ§∫
 * - Êèê‰æõÂø´ÈÄüÊìç‰ΩúÂÖ•Âè£
 * - ËÆ°ÁÆóÂíåÂ±ïÁ§∫ÂêÑÁßçÂ≠¶‰π†ÊåáÊ†á
 * - ÁîüÊàêËøûÁª≠Â≠¶‰π†Â§©Êï∞Êó•ÂéÜ
 */

import { ref, computed, onMounted } from 'vue'
import { useAuthStore } from '@/stores/auth'
import { useSubscriptionStore } from '@/stores/subscription'
import MainLayout from '@/layouts/MainLayout.vue'
import FeatureGate from '@/components/subscription/FeatureGate.vue'

// üîó HeroiconsÂõæÊ†áÁªÑ‰ª∂ÂØºÂÖ•
import {
  BookOpenIcon,
  AcademicCapIcon,
  ClockIcon,
  FireIcon,
  ChartBarIcon,
  UserIcon,
  ArrowRightIcon,
  StarIcon,
  LockClosedIcon
} from '@heroicons/vue/24/outline'

// üìä StoreÁä∂ÊÄÅÁÆ°ÁêÜ
const authStore = useAuthStore()
const subscriptionStore = useSubscriptionStore()

// üìã MockÂ≠¶‰π†ËøõÂ∫¶Êï∞ÊçÆ
// Âú®ÁúüÂÆûÂ∫îÁî®‰∏≠ÔºåËøô‰∫õÊï∞ÊçÆ‰ºö‰ªéAPIËé∑Âèñ
const progress = ref({
  articlesRead: 15,      // Â∑≤ËØªÊñáÁ´†Êï∞
  wordsLearned: 230,     // Â≠¶‰π†ÂçïËØçÊï∞
  studyTimeMinutes: 1250, // Â≠¶‰π†Êó∂ÈïøÔºàÂàÜÈíüÔºâ
  streak: 5,             // ËøûÁª≠Â≠¶‰π†Â§©Êï∞
  weeklyGoal: 300        // ÊØèÂë®ÁõÆÊ†áÊó∂ÈïøÔºàÂàÜÈíüÔºâ
})

// üìö MockÊúÄËøëÊñáÁ´†Êï∞ÊçÆ
const recentArticles = ref([
  {
    id: '1',
    title: 'The Future of Renewable Energy',
    category: 'Science',
    difficulty: 'intermediate',
    estimatedReadTime: 8,
    wordCount: 1420
  },
  {
    id: '2',
    title: 'Understanding Cultural Differences',
    category: 'Culture',
    difficulty: 'advanced',
    estimatedReadTime: 12,
    wordCount: 2100
  },
  {
    id: '3',
    title: 'Healthy Cooking Tips',
    category: 'Lifestyle',
    difficulty: 'beginner',
    estimatedReadTime: 5,
    wordCount: 890
  }
])

/**
 * üí∞ ËÆ°ÁÆóÂ≠¶‰π†Êó∂ÈïøÔºàÂ∞èÊó∂Ôºâ
 */
const studyHours = computed(() => {
  return Math.floor(progress.value.studyTimeMinutes / 60)
})

/**
 * üìä ËÆ°ÁÆóÊú¨Âë®Â≠¶‰π†Êó∂Èïø
 * MockÊï∞ÊçÆÔºöÂÅáËÆæ25%ÁöÑÊÄªÊó∂ÈïøÊòØÊú¨Âë®ÂÆåÊàêÁöÑ
 */
const weeklyStudyTime = computed(() => {
  return progress.value.studyTimeMinutes * 0.25
})

/**
 * üéØ ËÆ°ÁÆóÊØèÂë®ÁõÆÊ†áÂÆåÊàêÁôæÂàÜÊØî
 */
const weeklyProgress = computed(() => {
  return Math.min((weeklyStudyTime.value / progress.value.weeklyGoal) * 100, 100)
})

/**
 * üé® ËÆ¢ÈòÖÁä∂ÊÄÅÂæΩÁ´†Ê†∑Âºè
 */
const subscriptionBadgeClasses = computed(() => {
  const badge = subscriptionStore.getStatusBadge
  const baseClasses = 'px-3 py-1 rounded-full text-sm font-medium'
  
  switch (badge.color) {
    case 'green':
      return `${baseClasses} bg-green-100 text-green-800`
    case 'blue':
      return `${baseClasses} bg-blue-100 text-blue-800`
    case 'orange':
      return `${baseClasses} bg-orange-100 text-orange-800`
    case 'red':
      return `${baseClasses} bg-red-100 text-red-800`
    default:
      return `${baseClasses} bg-gray-100 text-gray-800`
  }
})

/**
 * üìÖ ÁîüÊàêËøûÁª≠Â≠¶‰π†Â§©Êï∞Êó•ÂéÜÊï∞ÊçÆ
 * ÊòæÁ§∫ËøáÂéª7Â§©ÁöÑÂ≠¶‰π†ÊÉÖÂÜµ
 */
const streakDays = computed(() => {
  const days = []
  const today = new Date()
  
  for (let i = 6; i >= 0; i--) {
    const date = new Date(today)
    date.setDate(date.getDate() - i)
    
    days.push({
      date: date.toLocaleDateString(),
      day: date.getDate(),
      hasStudied: i <= progress.value.streak - 1 // Ê†πÊçÆËøûÁª≠Â§©Êï∞Âà§Êñ≠ÊòØÂê¶Â≠¶‰π†
    })
  }
  
  return days
})

/**
 * üé® Ëé∑ÂèñÊñáÁ´†ÈöæÂ∫¶ÂØπÂ∫îÁöÑÊ†∑ÂºèÁ±ª
 * @param difficulty - ÊñáÁ´†ÈöæÂ∫¶Á∫ßÂà´
 */
const getDifficultyClasses = (difficulty: string) => {
  switch (difficulty) {
    case 'beginner':
      return 'bg-green-100 text-green-800'
    case 'intermediate':
      return 'bg-yellow-100 text-yellow-800'
    case 'advanced':
      return 'bg-red-100 text-red-800'
    default:
      return 'bg-gray-100 text-gray-800'
  }
}

/**
 * üîÑ ÁªÑ‰ª∂ÊåÇËΩΩÊó∂Âä†ËΩΩÊï∞ÊçÆ
 */
onMounted(() => {
  // Âú®ÁúüÂÆûÂ∫îÁî®‰∏≠ÔºåËøôÈáå‰ºöË∞ÉÁî®APIÂä†ËΩΩÁî®Êà∑ËøõÂ∫¶Êï∞ÊçÆ
  // ‰æãÂ¶ÇÔºöawait progressService.getUserProgress()
})
</script>